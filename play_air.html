<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üå≥ Plant More Trees - Air Pollution Game</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      text-align: center;
      font-family: "Poppins", sans-serif;
      background: linear-gradient(to top, #d0f0c0, #aee1f9);
    }

    canvas {
      display: block;
      margin: 20px auto;
      background: url('{{ url_for("static", filename="images/background_air.png") }}') no-repeat center;
      background-size: cover;
      border: 4px solid #4caf50;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }

    #scoreboard {
      font-size: 22px;
      color: #2e7d32;
      font-weight: bold;
    }

    #warning {
      font-size: 20px;
      color: #d32f2f;
      font-weight: bold;
      margin-top: 10px;
      display: none;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      50% { opacity: 0.5; }
    }

    #game-over {
      display: none;
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.9);
      padding: 25px 40px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    button {
      background-color: #4caf50;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 18px;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background-color: #2e7d32;
    }
  </style>
</head>
<body>

  <h1>üå≥ Plant More Trees!</h1>

  <!-- Added Air Pollution Image -->
  <img src="{{ url_for('static', filename='images/air_icon.png') }}" 
       alt="Air Pollution Icon" 
       style="width:120px; margin:10px 0; border-radius:12px;">

  <div id="scoreboard">
    Trees Planted: <span id="score">0</span> |
    Pollution Level: <span id="pollution">0%</span>
  </div>

  <div id="warning">‚ö†Ô∏è Pollution reached 50%! Plant more trees to save your city!</div>

  <canvas id="gameCanvas" width="600" height="400"></canvas>

  <div id="game-over">
    <h2>Game Over üò∑</h2>
    <p>Final Trees Planted: <span id="finalScore"></span></p>
    <button onclick="restartGame()">Play Again</button>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const factoryImg = new Image();
    factoryImg.src = "{{ url_for('static', filename='images/factory.png') }}";
    const treeImg = new Image();
    treeImg.src = "{{ url_for('static', filename='images/tree.png') }}";
    const smokeImg = new Image();
    smokeImg.src = "{{ url_for('static', filename='images/smoke.png') }}";

    let trees = [];
    let smokes = [];
    let score = 0;
    let pollution = 0;
    let gameOver = false;
    let warningShown = false;

    function createSmoke() {
      const x = Math.random() * (canvas.width - 50);
      smokes.push({ x: x, y: canvas.height - 150, size: 30, speed: 1 + Math.random() * 1.5 });
    }

    function drawFactory() {
      ctx.drawImage(factoryImg, 220, canvas.height - 100, 150, 80);
    }

    function drawTrees() {
      trees.forEach(tree => {
        ctx.drawImage(treeImg, tree.x, tree.y, 40, 60);
      });
    }

    function drawSmokes() {
      smokes.forEach(smoke => {
        ctx.globalAlpha = 0.8;
        ctx.drawImage(smokeImg, smoke.x, smoke.y, smoke.size, smoke.size);
        ctx.globalAlpha = 1;
      });
    }

    function updateSmokes() {
      for (let i = 0; i < smokes.length; i++) {
        smokes[i].y -= smokes[i].speed;
        smokes[i].size += 0.05;

        if (smokes[i].y + smokes[i].size < 0) {
          smokes.splice(i, 1);
          i--;
          pollution += 5;
          if (pollution >= 50 && !warningShown) {
            document.getElementById("warning").style.display = "block";
            warningShown = true;
          }
          if (pollution >= 100) endGame();
        }
      }
      document.getElementById("pollution").textContent = pollution + "%";
    }

    canvas.addEventListener("click", (e) => {
      if (gameOver) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left - 20;
      const y = e.clientY - rect.top - 40;
      trees.push({ x, y });
      score++;
      if (pollution > 0) pollution -= 3;
      if (pollution < 50 && warningShown) {
        document.getElementById("warning").style.display = "none";
        warningShown = false;
      }
      document.getElementById("score").textContent = score;
      document.getElementById("pollution").textContent = pollution + "%";
    });

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawFactory();
      drawTrees();
      drawSmokes();
    }

    function update() {
      if (!gameOver) {
        updateSmokes();
        draw();
        requestAnimationFrame(update);
      }
    }

    function smokeLoop() {
      if (!gameOver) {
        createSmoke();
        setTimeout(smokeLoop, 1200);
      }
    }

    function endGame() {
      gameOver = true;
      document.getElementById("finalScore").textContent = score;
      document.getElementById("game-over").style.display = "block";
      document.getElementById("warning").style.display = "none";
    }

    function restartGame() {
      trees = [];
      smokes = [];
      score = 0;
      pollution = 0;
      gameOver = false;
      warningShown = false;
      document.getElementById("score").textContent = score;
      document.getElementById("pollution").textContent = pollution + "%";
      document.getElementById("game-over").style.display = "none";
      document.getElementById("warning").style.display = "none";
      smokeLoop();
      update();
    }

    smokeLoop();
    update();
  </script>
</body>
</html>
